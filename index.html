<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Oru Village â€“ Oru Market</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body { font-family: Arial; margin: 0; background:#f3f4f6 }
header { background:#15803d; color:#fff; padding:15px; text-align:center }
.container { max-width:1000px; margin:auto; padding:20px }
.card { background:#fff; padding:15px; border-radius:8px; margin-bottom:15px }
input, select, button { width:100%; padding:8px; margin:5px 0 }
button { cursor:pointer; border:none; border-radius:5px }
.green { background:#16a34a; color:#fff }
.outline { border:1px solid #16a34a; background:#fff; color:#16a34a }
.grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(250px,1fr)); gap:10px }
.hidden { display:none }
.price { color:#15803d; font-weight:bold }
</style>
</head>

<body>

<header>
  ğŸŒ¾ Oru Village â€“ Oru Market
</header>

<div class="container">

<!-- ROLE -->
<div id="role" class="card">
  <button class="green" onclick="showTech()">Tech Person</button>
  <button class="outline" onclick="showBuyer()">Buyer</button>
</div>

<!-- TECH PERSON -->
<div id="tech" class="card hidden">
  <h3>ğŸ‘¨â€ğŸ’» Tech Person</h3>

  <input id="techPhone" placeholder="Tech Person Phone">
  <input id="farmer" placeholder="Farmer Name">
  <input id="village" placeholder="Village">
  <select id="crop">
    <option>Rice</option>
    <option>Karumbu</option>
    <option>Maize</option>
  </select>
  <input id="price" placeholder="Price">
  <input id="qty" placeholder="Quantity">

  <button class="green" onclick="saveCrop()">Save Crop</button>
  <button class="outline" onclick="back()">Back</button>
</div>

<!-- BUYER -->
<div id="buyer" class="hidden">
  <h3>ğŸ›’ Available Crops</h3>
  <div id="cropList" class="grid"></div>
  <button class="outline" onclick="back()">Back</button>
</div>

</div>

<script>
const API_URL = "https://farmer-service-9e5o.onrender.com"; // CHANGE if needed

function showTech(){
  role.classList.add("hidden");
  tech.classList.remove("hidden");
}

function showBuyer(){
  role.classList.add("hidden");
  buyer.classList.remove("hidden");
  loadCrops();
}

function back(){
  tech.classList.add("hidden");
  buyer.classList.add("hidden");
  role.classList.remove("hidden");
}

function saveCrop(){
  const data = {
    techPhone: techPhone.value,
    farmer: farmer.value,
    village: village.value,
    crop: crop.value,
    price: price.value,
    qty: qty.value
  };

  fetch(API_URL + "/crop", {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify(data)
  })
  .then(()=> alert("Crop saved"))
}

function loadCrops(){
  fetch(API_URL + "/crops")
    .then(res=>res.json())
    .then(data=>{
      cropList.innerHTML="";
      data.forEach((c,i)=>{
        cropList.innerHTML += `
        <div class="card">
          <b>${c.farmer}</b> (${c.village})<br>
          ğŸŒ¾ ${c.crop}<br>
          <span class="price">â‚¹${c.price}</span><br>
          Qty: ${c.qty}<br>
          <button onclick="deleteCrop(${i})">Delete</button>
        </div>`;
      })
    })
}

function deleteCrop(id){
  const phone = prompt("Enter Tech Phone to delete");
  fetch(API_URL + "/crop/" + id,{
    method:"DELETE",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({ techPhone: phone })
  })
  .then(res=>{
    if(res.status==403) alert("Not allowed");
    else loadCrops();
  })
}
</script>

</body>
</html>
